\documentclass[12pt]{article}


\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb,graphicx,bm,bbm,setspace,url,xcolor}
\usepackage{enumitem}
\usepackage{fancyvrb}
\usepackage{soul}

\DeclareMathOperator{\1nd}{\mathbbm{1}}
\DeclareMathOperator{\E}{\mathbb{E}}
\DeclareMathOperator{\Var}{Var}
\DeclareMathOperator{\Cov}{Cov}
\DeclareMathOperator{\logit}{logit}

\title{BIOS 6612 Homework 3: Case-control data and other link functions for binary response data }

\date{}

\begin{document}
\maketitle

\begin{enumerate}
	\item (\textbf{30 points}) Bacterial growth in donated blood can lead to severe infections in transfusion patients. In the absence of limiting factors, bacteria growth follows a power law, with a strain-specific doubling time of $\theta$ in some arbitrary time unit. 
	
	Suppose we have $n=20$ bags of donated blood. Each contains 100 mL of blood and is infused with a common strain of bacteria at time 0. At $t=8, 12, 16$ hours subsequent to time 0, a 1-mL sample is drawn from each bag and tested for the presence or absence of bacteria. The table below shows the number of bags testing positive at each time point.

\begin{center}
	\begin{tabular}{rr}
		Time & Num. bags \\
		(hours) & positive \\
		\hline
		8 & 5 \\
		12 & 10 \\
		16 & 19
	\end{tabular}
\end{center}
	
	Assume that the actual number of bacteria present in a sample of (known) fraction
$k$ at time $t$ follows a Poisson distribution with mean $k\cdot 2^{t/\theta}$. Let $\mathbf{Y}_i=(Y_{i1},Y_{i2},Y_{i3})'$ be the indicators of presence ($Y_{ij}=1$) or absence ($Y_{ij}=0$) of bacteria at each of the three observation times for the $i$th blood bag.
	\begin{enumerate}
		\item Give the likelihood for the data as a function of $\theta$. (\textbf{4 points}) 
		\item Show that the MLE of $\theta$ can be obtained from a GLM with a binary response, covariate of $t_j$, complementary log-log link function, offset equal to $\log k$, and no intercept. (\textbf{8 points}) 
		\item Fit this model using standard software for generalized linear models; provide your code and model output. Note that $k=1/100$ since each sample is 1 mL drawn from the original volume of 100 mL in each bag. (\textbf{8 points})
		\item Using your model output, give the MLE of $\theta$ and an associated 95\% confidence interval. (\textbf{5 points}) 
		\item Compute a measure of model deviance that can be approximated by a $\chi^2$ distribution and assess the fit of the model. (\textbf{5 points}) 
	\end{enumerate}

\item (\textbf{40 points}) We can use logistic regression to estimate the odds ratio as a measure of association between a binary exposure and a binary outcome regardless of whether cohort or case-control sampling is used. For this question, you will need to conduct a simulation study to verify this result. The parameters needed for this simulation are given below:
\begin{itemize}
	\item Population size $N=$100,000
	\item Prevalence of disease
		\begin{itemize}
				\item 5\% in unexposed
				\item 10\% in exposed
		\end{itemize}
	\item Prevalence of exposure is 30\%
\end{itemize}

\begin{enumerate}
	\item Give the parameters needed to simulate the outcome conditional on exposure, assuming a logistic regression model in the population. (\textbf{6 points}) 
	\item Generate data on exposure and outcome for the entire population. \textit{Hint:} In R, you can use the function \texttt{rbinom(N,1,prob)} to generate \texttt{N} independent Bernoulli variables with mean \texttt{prob}. (\textbf{9 points}) 
	\item Now that you have a population, conduct 1000 simulations where you randomly select $n=50$ individuals with the exposure and another $n=50$ without the exposure; this represents a cohort study. For each simulation, fit the appropriate logistic regression model and record the parameter estimates. Give both the mean and median of each the estimates of each parameter across all simulations. Why might these not agree with one another? (\textbf{10 points}) 
	\item Repeat the previous question for a case-control design: that is, randomly sample $n=50$ individuals with the disease and $n=50$ without the disease, then fit the appropriate logistic regression model. As before, record the estimated values of the parameters for each of your 1000 simulations. Give the mean and median of the estimates across all simulations. (\textbf{8 points}) 
	\item Both the cohort and case-control designs are estimating the same odds ratio between exposure and disease, but their efficiency might be different. Compare the variability of the estimated log odds ratios between the two designs and explain any differences you find. \textit{Hint:} the \texttt{mad()} command in R computes a robust estimate of spread and might be useful if you find large differences between mean and median estimated parameter values. (\textbf{7 points}) 
\end{enumerate}

\end{enumerate}

\end{document}
